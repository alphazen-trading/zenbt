{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"ZenBt","text":"<p>A python financial backtesting engine written in rust.</p>"},{"location":"#moving-average-cross-over-example","title":"Moving Average Cross over example:","text":""},{"location":"#creating-the-class","title":"Creating the class:","text":"<pre><code>from zenbt.sdk.base import BaseStrategy\nfrom zenbt.zbt import (\n    Side,\n    Action,\n)\n\n\nclass MaCross(BaseStrategy):\n    default_size = 1_000_000\n\n    def on_candle(self, state=None, **kwargs) -&gt; Action:  # type: ignore\n        # Get the Data at the index\n        cross_below = self.data[\"cross_below\"][self.index]\n        cross_above = self.data[\"cross_above\"][self.index]\n\n        # Check for bullish cross over\n        if cross_above:\n            order = self.create_market_order(\n                self.index,\n                client_order_id=\"Long\",\n                side=Side.Long,\n                size=self.default_size,\n            )\n            return Action(\n                orders={order.client_order_id: order},\n                close_all_positions=True,\n            )\n\n        # Check for bearish crossover\n        if cross_below:\n            order = self.create_market_order(\n                self.index,\n                client_order_id=\"Short\",\n                side=Side.Short,\n                size=self.default_size,\n            )\n            return Action(\n                orders={order.client_order_id: order},\n                close_all_positions=True,\n            )\n\n        return self.action\n</code></pre>"},{"location":"#running-the-backtest","title":"Running the backtest:","text":"<pre><code>from zenbt.data import get_sample_btc_data\nfrom zenbt.strategies import MaCross\nfrom zenbt.sdk import Stats\nfrom zenbt.zbt import Backtest, cross_above, cross_below\nimport talib\n\n# This will return a sample BTC dataset\ndf = get_sample_btc_data()\n\n\n# We will use talib to generate the slow and fast MA data\nfast_ma = talib.SMA(df[\"close\"], timeperiod=10)\nslow_ma = talib.SMA(df[\"close\"], timeperiod=50)\ndf = df.with_columns(\n    pl.Series(\"cross_above\", cross_above(fast_ma, slow_ma)),\n    pl.Series(\"cross_below\", cross_below(fast_ma, slow_ma)),\n)\n\n# Initiate the MACross class we created above\nma_cross = MaCross(df, default_size=1)\n\n# Initiate the backtest parameters\nbt_params = BacktestParams(\n    commission_pct=0.02 / 100,  # This is 2 bps\n    initial_capital=100_000,\n    provide_active_position=True,\n)\n\n# Create the Backtest engine\nbt = Backtest(df, bt_params, ma_cross)\n\n# Run the backtest\nbt.backtest()\n\n# Display the stats\nstats = Stats(bt, df)\nstats.print()\n</code></pre> <pre><code>               Trading Summary\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Metric           \u2503                   Value \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 initial_capital  \u2502              100,000.00 \u2502\n\u2502 pnl              \u2502                9,101.40 \u2502\n\u2502 pnl_pct          \u2502                    9.10 \u2502\n\u2502 unrealized_pnl   \u2502                   45.20 \u2502\n\u2502 total_positions  \u2502                  15,829 \u2502\n\u2502 closed_positions \u2502                  15,828 \u2502\n\u2502 active_positions \u2502                       1 \u2502\n\u2502 commissions      \u2502               32,792.58 \u2502\n\u2502 wins             \u2502                4,988.00 \u2502\n\u2502 losses           \u2502               10,840.00 \u2502\n\u2502 win_rate         \u2502                  31.51% \u2502\n\u2502 trading_days     \u2502                     380 \u2502\n\u2502 start_date       \u2502 2023-08-21 18:33:00 UTC \u2502\n\u2502 end_date         \u2502 2024-09-05 18:27:00 UTC \u2502\n\u2502 max_drawdown     \u2502                4,693.10 \u2502\n\u2502 max_drawdown_pct \u2502                    4.69 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/zenbt/__init__/","title":"Zenbt","text":""},{"location":"reference/zenbt/multi_backtest/","title":"Multi backtest","text":""},{"location":"reference/zenbt/data/__init__/","title":"Data","text":""},{"location":"reference/zenbt/data/data/","title":"Data","text":""},{"location":"reference/zenbt/grafana/__init__/","title":"Grafana","text":""},{"location":"reference/zenbt/grafana/dashboard/","title":"Dashboard","text":""},{"location":"reference/zenbt/grafana/dashboard/#zenbt.grafana.dashboard.GrafanaDashboard","title":"GrafanaDashboard","text":"<pre><code>GrafanaDashboard()\n</code></pre> <p>Initialize the uploader with Grafana server details and credentials.</p> Source code in <code>src/zenbt/grafana/dashboard.py</code> <pre><code>def __init__(self):\n    \"\"\"\n    Initialize the uploader with Grafana server details and credentials.\n    \"\"\"\n    self.auth = HTTPBasicAuth(self.username, self.password)\n    self.headers = {\"Content-Type\": \"application/json\"}\n</code></pre>"},{"location":"reference/zenbt/grafana/dashboard/#zenbt.grafana.dashboard.GrafanaDashboard.delete_dashboard","title":"delete_dashboard","text":"<pre><code>delete_dashboard(dashboard_uid: str) -&gt; bool\n</code></pre> <p>Delete a dashboard by its UID.</p> <p>:param dashboard_uid: UID of the dashboard to delete :return: True if deletion was successful, False otherwise</p> Source code in <code>src/zenbt/grafana/dashboard.py</code> <pre><code>def delete_dashboard(self, dashboard_uid: str) -&gt; bool:\n    \"\"\"\n    Delete a dashboard by its UID.\n\n    :param dashboard_uid: UID of the dashboard to delete\n    :return: True if deletion was successful, False otherwise\n    \"\"\"\n    response = requests.delete(\n        f\"{self.grafana_url}/api/dashboards/uid/{dashboard_uid}\",\n        headers=self.headers,\n        auth=self.auth,\n    )\n\n    if response.status_code == 200:\n        print(f\"Dashboard with UID '{dashboard_uid}' deleted successfully.\")\n        return True\n    else:\n        print(\n            f\"Failed to delete dashboard. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return False\n</code></pre>"},{"location":"reference/zenbt/grafana/dashboard/#zenbt.grafana.dashboard.GrafanaDashboard.get_dashboard_uid_by_name","title":"get_dashboard_uid_by_name","text":"<pre><code>get_dashboard_uid_by_name(\n    dashboard_name: str,\n) -&gt; Optional[str]\n</code></pre> <p>Retrieve the UID of a dashboard by its name.</p> <p>:param dashboard_name: Name of the dashboard :return: UID of the dashboard if found, None otherwise</p> Source code in <code>src/zenbt/grafana/dashboard.py</code> <pre><code>def get_dashboard_uid_by_name(self, dashboard_name: str) -&gt; Optional[str]:\n    \"\"\"\n    Retrieve the UID of a dashboard by its name.\n\n    :param dashboard_name: Name of the dashboard\n    :return: UID of the dashboard if found, None otherwise\n    \"\"\"\n    search_response = requests.get(\n        f\"{self.grafana_url}/api/search\",\n        headers=self.headers,\n        auth=self.auth,\n        params={\"query\": dashboard_name},\n    )\n\n    if search_response.status_code == 200:\n        for item in search_response.json():\n            if (\n                item.get(\"title\") == dashboard_name\n                and item.get(\"type\") == \"dash-db\"\n            ):\n                return item.get(\"uid\")\n        print(f\"Dashboard with name '{dashboard_name}' not found.\")\n    else:\n        print(\n            f\"Failed to search dashboards. Status code: {search_response.status_code}, Response: {search_response.text}\"\n        )\n    return None\n</code></pre>"},{"location":"reference/zenbt/grafana/dashboard/#zenbt.grafana.dashboard.GrafanaDashboard.upload_dashboard","title":"upload_dashboard","text":"<pre><code>upload_dashboard(\n    json_file_path: str,\n    dashboard_name: str,\n    folder_uid: Optional[str] = None,\n) -&gt; bool\n</code></pre> <p>Upload a dashboard to Grafana.</p> <p>:param json_file_path: Path to the JSON file containing the dashboard definition :param dashboard_name: Desired name for the dashboard in Grafana :param folder_uid: UID of the folder to save the dashboard in (optional) :return: True if upload was successful, False otherwise</p> Source code in <code>src/zenbt/grafana/dashboard.py</code> <pre><code>def upload_dashboard(\n    self, json_file_path: str, dashboard_name: str, folder_uid: Optional[str] = None\n) -&gt; bool:\n    \"\"\"\n    Upload a dashboard to Grafana.\n\n    :param json_file_path: Path to the JSON file containing the dashboard definition\n    :param dashboard_name: Desired name for the dashboard in Grafana\n    :param folder_uid: UID of the folder to save the dashboard in (optional)\n    :return: True if upload was successful, False otherwise\n    \"\"\"\n    try:\n        with open(json_file_path, \"r\") as file:\n            dashboard_json = json.load(file)\n    except Exception as e:\n        print(f\"Error reading JSON file: {e}\")\n        return False\n\n    # Update the dashboard title\n    dashboard_json[\"title\"] = dashboard_name\n\n    # Prepare the payload\n    payload = {\"dashboard\": dashboard_json, \"overwrite\": True}\n\n    if folder_uid:\n        payload[\"folderUid\"] = folder_uid\n\n    # Send the request to Grafana\n    response = requests.post(\n        f\"{self.grafana_url}/api/dashboards/db\",\n        headers=self.headers,\n        auth=self.auth,\n        data=json.dumps(payload),\n    )\n\n    if response.status_code == 200:\n        print(f\"Dashboard '{dashboard_name}' uploaded successfully.\")\n        return True\n    else:\n        print(\n            f\"Failed to upload dashboard. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return False\n</code></pre>"},{"location":"reference/zenbt/grafana/token_manager/","title":"Token manager","text":""},{"location":"reference/zenbt/grafana/token_manager/#zenbt.grafana.token_manager.TokenManager","title":"TokenManager","text":"<p>               Bases: <code>BaseModel</code></p>"},{"location":"reference/zenbt/grafana/token_manager/#zenbt.grafana.token_manager.TokenManager.create_service_account","title":"create_service_account","text":"<pre><code>create_service_account()\n</code></pre> <p>Create a new service account.</p> <p>:param name: Desired name for the service account :param role: Role for the service account ('Viewer', 'Editor', or 'Admin') :return: Dictionary containing service account details or None if creation failed</p> Source code in <code>src/zenbt/grafana/token_manager.py</code> <pre><code>def create_service_account(self):\n    \"\"\"\n    Create a new service account.\n\n    :param name: Desired name for the service account\n    :param role: Role for the service account ('Viewer', 'Editor', or 'Admin')\n    :return: Dictionary containing service account details or None if creation failed\n    \"\"\"\n    payload = {\"name\": self.service_account_name, \"role\": \"Admin\"}\n    response = requests.post(\n        f\"{self.grafana_url}/api/serviceaccounts\",\n        headers=self.headers,\n        auth=self.auth,\n        data=json.dumps(payload),\n    )\n    if response.status_code == 201:\n        return response.json()\n    else:\n        print(\n            f\"Failed to create service account. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return None\n</code></pre>"},{"location":"reference/zenbt/grafana/token_manager/#zenbt.grafana.token_manager.TokenManager.delete_service_account","title":"delete_service_account","text":"<pre><code>delete_service_account(service_account_id)\n</code></pre> <p>Delete an existing service account by its ID.</p> <p>:param service_account_id: ID of the service account to be deleted :return: True if deletion was successful, False otherwise</p> Source code in <code>src/zenbt/grafana/token_manager.py</code> <pre><code>def delete_service_account(self, service_account_id):\n    \"\"\"\n    Delete an existing service account by its ID.\n\n    :param service_account_id: ID of the service account to be deleted\n    :return: True if deletion was successful, False otherwise\n    \"\"\"\n    response = requests.delete(\n        f\"{self.grafana_url}/api/serviceaccounts/{service_account_id}\",\n        headers=self.headers,\n        auth=self.auth,\n    )\n    if response.status_code == 200:\n        print(f\"Service Account with ID {service_account_id} deleted successfully.\")\n        return True\n    else:\n        print(\n            f\"Failed to delete service account. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return False\n</code></pre>"},{"location":"reference/zenbt/grafana/token_manager/#zenbt.grafana.token_manager.TokenManager.delete_service_account_by_name","title":"delete_service_account_by_name","text":"<pre><code>delete_service_account_by_name()\n</code></pre> <p>Delete a service account by its name.</p> <p>:param name: Name of the service account to be deleted :return: True if deletion was successful, False otherwise</p> Source code in <code>src/zenbt/grafana/token_manager.py</code> <pre><code>def delete_service_account_by_name(self):\n    \"\"\"\n    Delete a service account by its name.\n\n    :param name: Name of the service account to be deleted\n    :return: True if deletion was successful, False otherwise\n    \"\"\"\n    service_account_id = self.get_service_account_id_by_name()\n    if service_account_id is None:\n        return False\n\n    response = requests.delete(\n        f\"{self.grafana_url}/api/serviceaccounts/{service_account_id}\",\n        headers=self.headers,\n        auth=self.auth,\n    )\n    if response.status_code == 200:\n        print(\n            f\"Service account '{self.service_account_name}' deleted successfully.\"\n        )\n        return True\n    else:\n        print(\n            f\"Failed to delete service account '{self.service_account_name}'. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return False\n</code></pre>"},{"location":"reference/zenbt/grafana/token_manager/#zenbt.grafana.token_manager.TokenManager.generate_service_account_token","title":"generate_service_account_token","text":"<pre><code>generate_service_account_token(\n    service_account_id, token_name\n)\n</code></pre> <p>Generate a token for an existing service account.</p> <p>:param service_account_id: ID of the service account :param token_name: Desired name for the token :return: Dictionary containing token details or None if generation failed</p> Source code in <code>src/zenbt/grafana/token_manager.py</code> <pre><code>def generate_service_account_token(self, service_account_id, token_name):\n    \"\"\"\n    Generate a token for an existing service account.\n\n    :param service_account_id: ID of the service account\n    :param token_name: Desired name for the token\n    :return: Dictionary containing token details or None if generation failed\n    \"\"\"\n    payload = {\"name\": token_name}\n    response = requests.post(\n        f\"{self.grafana_url}/api/serviceaccounts/{service_account_id}/tokens\",\n        headers=self.headers,\n        auth=self.auth,\n        data=json.dumps(payload),\n    )\n    if response.status_code == 200:\n        return response.json()\n    else:\n        print(\n            f\"Failed to create service account token. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return None\n</code></pre>"},{"location":"reference/zenbt/grafana/token_manager/#zenbt.grafana.token_manager.TokenManager.get_service_account_id_by_name","title":"get_service_account_id_by_name","text":"<pre><code>get_service_account_id_by_name()\n</code></pre> <p>Retrieve the ID of a service account by its name.</p> <p>:param name: Name of the service account :return: Service account ID if found, None otherwise</p> Source code in <code>src/zenbt/grafana/token_manager.py</code> <pre><code>def get_service_account_id_by_name(self):\n    \"\"\"\n    Retrieve the ID of a service account by its name.\n\n    :param name: Name of the service account\n    :return: Service account ID if found, None otherwise\n    \"\"\"\n    response = requests.get(\n        f\"{self.grafana_url}/api/serviceaccounts/search\",\n        headers=self.headers,\n        auth=self.auth,\n        params={\"query\": self.service_account_name},\n    )\n    if response.status_code == 200:\n        accounts = response.json().get(\"serviceAccounts\", [])\n        for account in accounts:\n            if account[\"name\"] == self.service_account_name:\n                return account[\"id\"]\n        print(f\"Service account with name '{self.service_account_name}' not found.\")\n        return None\n    else:\n        print(\n            f\"Failed to retrieve service accounts. Status code: {response.status_code}, Response: {response.text}\"\n        )\n        return None\n</code></pre>"},{"location":"reference/zenbt/sdk/__init__/","title":"Sdk","text":""},{"location":"reference/zenbt/sdk/base/","title":"Base","text":""},{"location":"reference/zenbt/sdk/base/#zenbt.sdk.base.BaseStrategy","title":"BaseStrategy","text":"<p>               Bases: <code>Strategy</code></p>"},{"location":"reference/zenbt/sdk/base/#zenbt.sdk.base.BaseStrategy.state","title":"state","text":"<pre><code>state: PySharedState\n</code></pre> <p>The current state of the backtest</p>"},{"location":"reference/zenbt/sdk/create_session/","title":"Create session","text":""},{"location":"reference/zenbt/sdk/logger/","title":"Logger","text":""},{"location":"reference/zenbt/sdk/plotter/","title":"Plotter","text":""},{"location":"reference/zenbt/sdk/stats/","title":"Stats","text":""},{"location":"reference/zenbt/sdk/trade_record/","title":"Trade record","text":""},{"location":"reference/zenbt/strategies/__init__/","title":"Strategies","text":""},{"location":"reference/zenbt/strategies/ma_cross/","title":"Ma cross","text":""}]}